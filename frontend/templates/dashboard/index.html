<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CareerAI</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link href="{{ url_for('static', filename='css/main.css') }}?v={{ range(1, 99999) | random }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/dashboard.css') }}?v={{ range(1, 99999) | random }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/animations.css') }}?v={{ range(1, 99999) | random }}" rel="stylesheet">
    
    <style>
        /* Font Awesome icon rendering fix */
        .fas, .far, .fab, .fa {
            font-family: "Font Awesome 6 Free", "FontAwesome" !important;
            font-weight: 900;
            font-style: normal;
            display: inline-block;
            -webkit-font-smoothing: antialiased;
        }
        .brand-mark i, .user-avatar i, .nav-item i {
            display: inline-block !important;
            font-family: "Font Awesome 6 Free" !important;
            font-weight: 900 !important;
        }
    </style>
</head>
<body class="dashboard-body">
    <div class="dashboard-shell">
        <aside class="dashboard-sidebar">
            <div class="sidebar-brand">
                <div class="brand-mark"><i class="fas fa-brain"></i></div>
                <div>
                    <div class="brand-title">CareerAI</div>
                    <div class="brand-subtitle">Skill-Based Matching</div>
                </div>
            </div>

            <div class="sidebar-user">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div>
                    <div class="user-name">{% if user.first_name or user.last_name %}{{ user.first_name }} {{ user.last_name }}{% else %}User{% endif %}</div>
                    <div class="user-email">{{ user.email }}</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a class="nav-item active" href="#overview" id="dashboardNav">
                    <i class="fas fa-th-large"></i>
                    Dashboard
                </a>
                <a class="nav-item" href="#input-modes" id="uploadResumeNav">
                    <i class="fas fa-file-upload"></i>
                    Upload Resume
                </a>
                <a class="nav-item" href="#manual-profile" id="manualProfileNav">
                    <i class="fas fa-edit"></i>
                    Manual Profile
                </a>
                <a class="nav-item" href="#career-matches" id="careersNav">
                    <i class="fas fa-briefcase"></i>
                    Career Matches
                </a>
                <a class="nav-item" href="#skill-gap" id="skillsNav">
                    <i class="fas fa-chart-bar"></i>
                    Skill Gap
                </a>
                <a class="nav-item" href="#roadmap" id="roadmapNav">
                    <i class="fas fa-map-marked-alt"></i>
                    Learning Roadmap
                </a>
                <a class="nav-item" href="#feedback" id="feedbackNav">
                    <i class="fas fa-comments"></i>
                    Feedback History
                </a>
                <a class="nav-item" href="/logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="status-chip">
                    <span class="status-dot"></span>
                    System ready for profile input
                </div>
            </div>
        </aside>

        <main class="dashboard-main">
            <section class="hero-panel" id="overview">
                <div class="hero-content">
                    <p class="hero-eyebrow">Career Matching Dashboard</p>
                    <h1>Welcome back, {% if user.first_name %}{{ user.first_name }}{% else %}User{% endif %}.</h1>
                    <p class="hero-subtitle">
                        Upload a resume or enter details manually. Both routes create the same structured profile for
                        skill matching, explainable reasoning, and a learning roadmap.
                    </p>
                    <div class="hero-actions">
                        <button class="btn btn-primary hero-btn" id="getStartedBtn">
                            <i class="fas fa-bolt me-2"></i>Generate Matches
                        </button>
                        <a class="btn btn-outline-light hero-btn" href="#input-modes">
                            <i class="fas fa-arrow-down me-2"></i>Choose Input Mode
                        </a>
                    </div>
                </div>
                <div class="hero-meta">
                    <div class="meta-card">
                        <h5>Profile Status</h5>
                        <p class="meta-value" id="profileStatus">No profile</p>
                        <p class="meta-note">Upload resume or fill your profile to get career matches.</p>
                        <div class="mt-3">
                            <div class="small text-muted mb-2">Profile Completion</div>
                            <div class="progress" style="height: 8px;">
                                <div id="profileProgressBar" class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small id="profileCompletionText" class="text-muted">0% complete</small>
                        </div>
                    </div>
                    <div class="meta-card">
                        <h5>Matching Engine</h5>
                        <p class="meta-value">Skill overlap scoring</p>
                        <p class="meta-note">Transparent calculations, no fabricated metrics.</p>
                    </div>
                </div>
            </section>

            <section class="input-grid" id="input-modes">
                <div class="panel-card" id="resume-upload">
                    <div class="panel-header">
                        <div>
                            <h3>Resume Upload Mode</h3>
                            <p>PDF and DOCX supported. Resume text is parsed into skills, education, and experience.</p>
                        </div>
                        <span class="panel-tag">Mode A</span>
                    </div>
                    <div class="file-drop-zone" id="fileDropZone">
                        <div class="drop-zone-content">
                            <i class="fas fa-cloud-upload-alt drop-icon"></i>
                            <h6>Drop resume here</h6>
                            <p>or click to browse</p>
                            <input type="file" id="resumeUpload" class="d-none" accept=".pdf,.doc,.docx,.txt">
                        </div>
                        <div class="upload-progress d-none">
                            <div class="progress mb-3">
                                <div class="progress-bar progress-bar-animated" style="width: 0%"></div>
                            </div>
                            <small>Analyzing your resume...</small>
                        </div>
                    </div>
                    <p class="support-note">
                        Max 5MB. This creates the same structured profile as manual input.
                    </p>
                </div>

                <div class="panel-card" id="manual-profile">
                    <div class="panel-header">
                        <div>
                            <h3>Manual Profile Mode</h3>
                            <p>Fill in essentials when a resume is not available.</p>
                        </div>
                        <span class="panel-tag">Mode B</span>
                    </div>
                    <form id="manualProfileForm" class="manual-form">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Education level</label>
                                <select class="form-select" id="educationLevel">
                                    <option value="">Select</option>
                                    <option value="Diploma">Diploma</option>
                                    <option value="Bachelors">Bachelors</option>
                                    <option value="Masters">Masters</option>
                                    <option value="Doctorate">Doctorate</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Years of experience</label>
                                <input type="number" class="form-control" id="yearsExperience" min="0" step="0.5" placeholder="0">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Skills (comma separated)</label>
                                <input type="text" class="form-control" id="skillsInput" placeholder="Python, SQL, Data Analysis">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Career interests</label>
                                <input type="text" class="form-control" id="interestArea" placeholder="Data science, Backend development">
                            </div>
                        </div>
                        <button class="btn btn-secondary mt-3" type="submit">
                            <i class="fas fa-flask me-2"></i>Analyze Manual Profile
                        </button>
                    </form>
                </div>
            </section>

            <section class="insight-grid" id="career-matches">
                <div class="section-header">
                    <div>
                        <h2>Top Career Matches</h2>
                        <p>Based on direct skill overlap with the career dataset.</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-outline-primary" id="rerunAnalysisBtn" style="display:none;">
                            <i class="fas fa-sync-alt me-2"></i>Re-run Analysis
                        </button>
                        <button class="btn btn-outline-primary" id="exploreBtn">
                            <i class="fas fa-compass me-2"></i>Generate Recommendations
                        </button>
                    </div>
                </div>
                
                <!-- FILTER PANEL -->
                <div id="filterPanel" class="panel-card d-none" style="margin-bottom: 20px; background: #f8f9fa;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; justify-content: space-between;">
                        <h6 style="margin: 0;"><i class="fas fa-filter me-2"></i>Filter Results</h6>
                        <button id="clearFiltersBtn" class="btn btn-sm btn-link" style="text-decoration: none; padding: 0; color: #666;">Clear all</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <!-- Experience Level -->
                        <div>
                            <label class="small text-muted" style="display: block; margin-bottom: 6px;">Experience Level</label>
                            <select id="filterExperience" class="form-select form-select-sm">
                                <option value="">All levels</option>
                                <option value="entry">Entry level</option>
                                <option value="mid">Mid-level</option>
                                <option value="senior">Senior</option>
                            </select>
                        </div>
                        
                        <!-- Work Type -->
                        <div>
                            <label class="small text-muted" style="display: block; margin-bottom: 6px;">Work Type</label>
                            <select id="filterWorkType" class="form-select form-select-sm">
                                <option value="">All types</option>
                                <option value="remote">Remote</option>
                                <option value="onsite">On-site</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                        
                        <!-- Industry -->
                        <div>
                            <label class="small text-muted" style="display: block; margin-bottom: 6px;">Industry</label>
                            <select id="filterIndustry" class="form-select form-select-sm">
                                <option value="">All industries</option>
                                <option value="technology">Technology</option>
                                <option value="fintech">FinTech</option>
                                <option value="healthcare">Healthcare</option>
                                <option value="ecommerce">E-commerce</option>
                                <option value="consulting">Consulting</option>
                            </select>
                        </div>
                        
                        <!-- Match Score Range -->
                        <div>
                            <label class="small text-muted" style="display: block; margin-bottom: 6px;">Min Match Score</label>
                            <select id="filterMatchScore" class="form-select form-select-sm">
                                <option value="0">Any score</option>
                                <option value="40">40% or higher</option>
                                <option value="60">60% or higher</option>
                                <option value="75">75% or higher</option>
                            </select>
                        </div>
                        
                        <!-- Location -->
                        <div>
                            <label class="small text-muted" style="display: block; margin-bottom: 6px;">Location</label>
                            <input type="text" id="filterLocation" class="form-control form-control-sm" placeholder="e.g., Bangalore, India">
                        </div>
                    </div>
                </div>

                <div class="empty-state" id="recommendationsEmpty">
                    <i class="fas fa-compass"></i>
                    <h6>No recommendations yet</h6>
                    <p>Upload a resume or complete the manual profile to start.</p>
                </div>
                <div id="recommendationsList" class="recommendations-grid d-none"></div>
            </section>

            <section class="insight-grid" id="live-market">
                <div class="section-header">
                    <div>
                        <h2>Live Market Snapshot — India</h2>
                        <p>Real-time job opportunities powered by Adzuna API</p>
                    </div>
                </div>
                <div class="empty-state" id="liveJobsEmpty">
                    <i class="fas fa-bolt"></i>
                    <h6>No live results yet</h6>
                    <p>Upload a resume or submit a manual profile to fetch live jobs.</p>
                </div>
                <div id="liveJobsList" class="recommendations-grid d-none"></div>
            </section>

            <section class="insight-grid" id="skill-gap">
                <div class="section-header">
                    <div>
                        <h2>Skill Gap Summary</h2>
                        <p>Skills missing from the top matched roles.</p>
                    </div>
                </div>
                <div class="panel-card">
                    <div id="skillGapList" class="tag-list empty-list">No gaps calculated yet.</div>
                </div>
            </section>

            <section class="insight-grid" id="roadmap">
                <div class="section-header">
                    <div>
                        <h2>Learning Roadmap</h2>
                        <p>Actionable steps generated from missing skills.</p>
                    </div>
                </div>
                <div class="panel-card">
                    <ol id="roadmapList" class="roadmap-list">
                        <li>Complete a profile to generate a learning roadmap.</li>
                    </ol>
                </div>
            </section>

            <section class="insight-grid" id="feedback">
                <div class="section-header">
                    <div>
                        <h2>Feedback History</h2>
                        <p>Rate recommendations to support adaptive learning.</p>
                    </div>
                </div>
                <div class="panel-card">
                    <div id="feedbackList" class="empty-list">No feedback captured yet.</div>
                </div>
            </section>
            
            <footer style="margin-top: 60px; padding: 20px 0; border-top: 1px solid #e0e0e0; text-align: center; color: #666; font-size: 12px;">
                <div style="max-width: 1200px; margin: 0 auto;">
                    <p>
                        <i class="fas fa-database me-1"></i>
                        Job market data sourced from <strong>Adzuna Job Market API</strong>
                        <span id="dataLastUpdated" style="color: #999; margin-left: 10px;">• Updated in real-time</span>
                    </p>
                    <p style="margin-top: 8px; color: #999;">
                        Skill recommendations calculated from live job postings. No fabricated or synthetic data.
                    </p>
                </div>
            </footer>
        </main>
    </div>

    <div class="loading-overlay d-none" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner-border text-light" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Processing your request...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.DashboardModule) {
                DashboardModule.init();
            }
        });
    </script>
</body>
</html>